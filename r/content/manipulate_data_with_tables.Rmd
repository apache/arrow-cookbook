# Manipulating Data - Tables

In this chapter, we discuss recipes for manipulating data in tables.  We'll use 
this small dataset of popular movies in our examples.

```{r}
popular_movies <- data.frame(
  name = c(
    "The Shawshank Redemption", "The Godfather", "The Godfather: Part II",
    "The Dark Knight", "12 Angry Men", "Schindler's List",
    "The Lord of the Rings: The Return of the King", "Pulp Fiction",
    "The Good, the Bad and the Ugly",
    "The Lord of the Rings: The Fellowship of the Ring"
  ),
  release_date = c(
    "1994-09-10", "1972-03-14", "1974-12-12", "2008-07-14", "1957-04-10",
    "1993-11-30", "2003-12-01", "1994-05-21", "1966-12-23", "2001-12-10"
  ),
  oscar_nominations = c(7, 11, 11, 8, 3, 12, 11, 7, 0, 13),
  oscar_wins = c(0, 3, 6, 2, 0, 7, 11, 1, 0, 4),
  budget_millions = c(25, 6, 13, 185, 0.35, 22, 94, 8, 1.2, 93),
  run_time_mins = c(142, 175, 202, 152, 96, 195, 201, 154, 148, 178),
  based_on_novel = c("yes", "yes", "yes", "no", "no", "yes", "yes", "no", 
                     "no", "yes")
) 

popular_movies
```

```{r}
popular_movies_arrow <- Table$create(popular_movies)
popular_movies_arrow
```

The data manipulation syntax in arrow is based on dplyr, so you'll need to load
both packages before running these recipes.

```{r}
library(dplyr)
```

## Using dplyr verbs in arrow

## Using tidyverse functions in dplyr verbs in arrow

You want to use a tidyverse function in arrow

### Solution

## Using non-tidyverse arrow functions in dplyr verbs in arrow

You want to use a function which is implemented in arrow but not in tidyverse packages.

### Solution

```{r}
starwars %>%
  Table$create() %>%
  select(name) %>%
  mutate(padded_name = arrow_ascii_lpad(name, options = list(width = 10, padding = "*"))) %>%
  collect()
```

### Discussion

The arrow package's functionality has been written with the intention of 
enabling users to use dplyr verbs containing expressions which include base R 
and tidyverse functions.  Arrow C++ compute functions have been mapped to their 
base R or tidyverse equivalents where possible, and we strongly recommend that you use 
these mappings where possible, as the original functions are well documented
and the mapped versions have been tested to ensure the results returned are as 
expected.

However, there may be circumstances in which you might want to use a compute 
function from the Arrow C++ library which does not have a base R or tidyverse 
equivalent.  

You can find documentation of Arrow C++ compute functions in 
[the C++ documention](https://arrow.apache.org/docs/cpp/compute.html#available-functions).
This documentation lists all available compute functions, any associated options classes 
they need, and the valid data type that they can be used with.

You can list all available Arrow compute functions from R by calling 
`list_compute_functions()`.

```{r}
list_compute_functions()
```

The majority of functions here have been mapped to
their base R or tidyverse equivalent and can be called within a dplyr query by
prefixing their name with "arrow_".  

#### Compute functions with options

If the Arrow compute function that you want to call requires the use of an options
class to control its behavior, you must pass a list to the `options` parameter 
containing the options values.

For an Arrow C++ compute function which requires options to be specified to work
in R, the function must be associated with the appropriate class in the R 
package's C++ code.  At the time of writing, all compute functions available in
the development version of the arrow R package had been associated with their options
classes.  However, as the Arrow C++ library's functionality extends, compute 
functions may be added which do not yet have an R binding.  If you find a C++ 
compute function which you wish to use from the R package, please [open an issue
on the project JIRA](https://issues.apache.org/jira/projects/ARROW/issues).
# Manipulating Data - Tables

## Using dplyr verbs in arrow

You want to use a dplyr verb in arrow.

### Solution

```{r}
library(dplyr)
starwars %>%
  filter(species == "Human", homeworld == "Tatooine")
```
### Discussion

You can use most of the dplyr verbs directly from arrow.  

### See also

Introduction to dplyr - run `vignette("dplyr", package = "dplyr")` or view on the [pkgdown site](https://dplyr.tidyverse.org/articles/dplyr.html).

## Using base R or tidyverse functions in dplyr verbs in arrow

You want to use a tidyverse function or base R function in arrow.

### Solution

```{r}
starwars %>%
  Table$create() %>%
  filter(str_detect(name, "Darth")) %>%
  collect()
```

### Discussion

The arrow package's functionality has been written with the intention of 
enabling users to use dplyr verbs containing expressions which include base R 
and tidyverse functions.  If you find any base R or tidyverse functions which 
you would like to see a mapping of in arrow, please [open an issue
on the project JIRA](https://issues.apache.org/jira/projects/ARROW/issues).

If you try to call a function which does not have arrow mapping, the data will 
be pulled back into R, and you will see a warning message.


```{r}
starwars %>%
  Table$create() %>%
  mutate(name_split = str_split_fixed(name, " ", 2)) %>%
  collect()
```

## Using arrow functions in dplyr verbs in arrow

You want to use a function which is implemented in Arrow's C++ library but 
doesn't have a mapping to a base R or tidyverse equivalent.

### Solution

```{r}
starwars %>%
  Table$create() %>%
  select(name) %>%
  mutate(padded_name = arrow_ascii_lpad(name, options = list(width = 10, padding = "*"))) %>%
  collect()
```

### Discussion

Arrow C++ compute functions have been mapped to their 
base R or tidyverse equivalents where possible, and we strongly recommend that you use 
these mappings where possible, as the original functions are well documented
and the mapped versions have been tested to ensure the results returned are as 
expected.

However, there may be circumstances in which you might want to use a compute 
function from the Arrow C++ library which does not have a base R or tidyverse 
equivalent.  

You can find documentation of Arrow C++ compute functions in 
[the C++ documention](https://arrow.apache.org/docs/cpp/compute.html#available-functions).
This documentation lists all available compute functions, any associated options classes 
they need, and the valid data type that they can be used with.

You can list all available Arrow compute functions from R by calling 
`list_compute_functions()`.

```{r}
list_compute_functions()
```

The majority of functions here have been mapped to
their base R or tidyverse equivalent and can be called within a dplyr query by
prefixing their name with "arrow_".  

#### Compute functions with options

If the Arrow compute function that you want to call requires the use of an options
class to control its behavior, you must pass a list to the `options` parameter 
containing the options values.

For an Arrow C++ compute function which requires options to be specified to work
in R, the function must be associated with the appropriate class in the R 
package's C++ code.  At the time of writing, all compute functions available in
the development version of the arrow R package had been associated with their options
classes.  However, as the Arrow C++ library's functionality extends, compute 
functions may be added which do not yet have an R binding.  If you find a C++ 
compute function which you wish to use from the R package, please [open an issue
on the project JIRA](https://issues.apache.org/jira/projects/ARROW/issues).
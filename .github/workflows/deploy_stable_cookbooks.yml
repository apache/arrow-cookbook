on: push

name: Deploy Stable Cookbooks

jobs:
  make_stable_cookbooks:
    name: build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup R
        uses: r-lib/actions/setup-r@v2
        with:
          use-public-rspm: true
      - name: Setup pandoc
        uses: r-lib/actions/setup-pandoc@v2
      - name: Install dependencies
        run: |
          sudo apt update
          sudo apt install libcurl4-openssl-dev \
            libssl-dev \
            maven \
            openjdk-11-jdk \
            python3-pip


      - name: Setup tmate session
        uses: mxschmitt/action-tmate@v3


      - name: Run tests
        run: make test
      - name: Build and render books
        run: make all
      - name: Copy .asf.yaml
        run: cp .asf.yaml build/.asf.yaml
      - name: Upload book artifact
        uses: actions/upload-artifact@v4
        with:
          name: build_book
          path: build/
